<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Westpine! - School Documentary Series</title>
    <!-- Load Tailwind CSS via CDN for a modern, sleek look -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-red: #E50914; /* Netflix Red */
            --dark-bg: #141414; /* Deep Black */
            --light-text: #E5E5E5;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--light-text);
            min-height: 100vh;
        }
        .text-westpine {
            color: var(--primary-red);
        }
        .bg-westpine-dark {
            background-color: #222222;
        }
        .btn-primary {
            background-color: var(--primary-red);
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #F51C28;
        }
        /* Custom scrollbar style for carousels */
        .carousel::-webkit-scrollbar {
            height: 8px;
        }
        .carousel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'westpine-default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        // initialAuthToken is available but signInAnonymously is preferred here for simplicity/testing

        let db, auth, userId = null;
        let EPISODE_MAP = {}; // Global map of episodes for quick lookups
        let LATEST_EPISODE_ID = null; // Store the ID of the current hero episode

        // Function to replace alert() with a custom modal
        const showCustomModal = (title, message, type = 'Info') => {
            const modal = document.getElementById('custom-alert-modal');
            if (!modal) return;
            
            document.getElementById('custom-alert-title').textContent = title;
            document.getElementById('custom-alert-message').textContent = message;
            
            // Set color based on type
            const header = document.getElementById('custom-alert-header');
            header.className = `p-4 rounded-t-xl text-white ${type === 'Error' ? 'bg-red-700' : 'bg-westpine'}`;

            modal.classList.remove('hidden');
        };


        if (firebaseConfig) {
            // 1. Initialize Firebase
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // 2. Authentication and Initialization Logic
            const authReadyPromise = new Promise(resolve => {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        // Sign in anonymously
                        await signInAnonymously(auth);
                        userId = auth.currentUser.uid;
                    }
                    console.log("Firebase Auth Ready. User ID:", userId);
                    document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                    resolve(userId);
                });
            });
            
            // 3. Data Structure Paths
            const EPISODE_COLLECTION_PATH = `artifacts/${appId}/public/data/showData/episodes`;
            const getEpisodesCollectionRef = () => collection(db, EPISODE_COLLECTION_PATH);
            // Public data for global ratings
            const getEpisodeDataRef = (episodeId) => doc(db, `artifacts/${appId}/public/data/episodes`, episodeId);
            // Private data for user's My List
            const getFavoritesRef = () => doc(db, `artifacts/${appId}/users/${userId}/favorites`, 'myList');


            // 4. Initial Episode Data (Used for seeding the database only)
            const INITIAL_EPISODES = [
                { id: 'ep102', season: 1, title: 'Week of December 1-5', description: 'The Week we come back from thanksgiving break.', youtubeId: 'FayqlM-4TGI', duration: '47 Mins', imageUrl: 'https://placehold.co/400x225/E50914/ffffff?text=S1+EP1+THUMB', date: '2025-12-06' },
                { id: 'ep101', season: 1, title: 'Pilot', description: 'The Pilot of Westpine!', youtubeId: 'ikezqOy4yEQ', duration: '1 Hr', imageUrl: 'https://placehold.co/400x225/E50914/ffffff?text=S1+EP2+THUMB', date: '2025-12-02' }
            ];

            /** Checks if episode data exists in Firestore, if not, seeds it. */
            const ensureEpisodeDataAndListen = async (currentUserId) => {
                const q = query(getEpisodesCollectionRef());
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    console.log("Seeding initial episode data into Firestore...");
                    for (const ep of INITIAL_EPISODES) {
                        await setDoc(doc(db, EPISODE_COLLECTION_PATH, ep.id), ep);
                    }
                    console.log("Seeding complete.");
                }

                // Set up a snapshot listener for real-time updates to the episode list
                onSnapshot(q, (snapshot) => {
                    const episodes = snapshot.docs.map(doc => doc.data());
                    EPISODE_MAP = episodes.reduce((acc, ep) => { acc[ep.id] = ep; return acc; }, {});
                    
                    renderApp(episodes, currentUserId);
                });
            };

            // 5. Rating and Liking Functions (Updated)
            
            /** Renders the star rating component based on current data. */
            const renderStarRating = (episodeId, ratingData = {}) => {
                const container = document.getElementById('star-rating-container');
                if (!container || episodeId !== LATEST_EPISODE_ID) return; // Ensure only updating the hero rating

                const { totalStars = 0, count = 0, userRating = 0 } = ratingData;
                const averageRating = count > 0 ? (totalStars / count).toFixed(1) : 'N/A';
                
                let starsHTML = '';
                for (let i = 1; i <= 5; i++) {
                    const isFilled = i <= Math.round(averageRating);
                    const isUserRating = i === userRating;
                    
                    // Prioritize user rating indicator, otherwise use average fill
                    const fillColor = isUserRating ? 'text-red-500' : (isFilled ? 'text-yellow-400' : 'text-gray-600');
                    const strokeColor = isUserRating ? 'text-red-500' : 'text-gray-400';
                    const cursor = userId ? 'cursor-pointer' : 'cursor-default';
                    const fillType = isFilled ? 'currentColor' : 'none';

                    starsHTML += `
                        <svg data-rating="${i}" class="w-8 h-8 ${cursor} ${fillColor}" 
                            fill="${fillType}" stroke="${strokeColor}" 
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.637-.921 1.937 0l1.847 5.679a1.5 1.5 0 001.423 1.033h5.968c.969 0 1.371 1.24.588 1.81l-4.825 3.518a1.5 1.5 0 00-.54 1.691l1.847 5.679c.3.921-.755 1.688-1.54 1.118l-4.825-3.518a1.5 1.5 0 00-1.85 0l-4.825 3.518c-.784.57-1.84-.197-1.54-1.118l1.847-5.679a1.5 1.5 0 00-.54-1.691l-4.825-3.518c-.784-.57-.383-1.81.588-1.81h5.968a1.5 1.5 0 001.423-1.033l1.847-5.679z"></path>
                        </svg>
                    `;
                }

                container.innerHTML = `
                    <div class="flex items-center space-x-2 text-xl font-bold">
                        <span class="${averageRating !== 'N/A' ? 'text-yellow-400' : 'text-gray-400'}">${averageRating}</span>
                        <span class="text-sm text-gray-400">(${count} votes)</span>
                    </div>
                    <div class="flex mt-2 space-x-1">${starsHTML}</div>
                    ${userRating > 0 ? `<p class="mt-2 text-sm text-red-400">Your rating: ${userRating} stars</p>` : '<p class="mt-2 text-sm text-gray-400">Rate this episode!</p>'}
                `;
                
                // Attach event listeners
                if (userId) {
                    container.querySelectorAll('svg').forEach(star => {
                        star.onclick = (e) => handleRating(episodeId, parseInt(e.currentTarget.dataset.rating));
                    });
                }
            };
            
            /** Handles a user submitting a star rating. */
            const handleRating = async (episodeId, newRating) => {
                if (!userId) {
                    showCustomModal('Authentication Error', 'Please wait for the site to finish loading before rating.', 'Error');
                    return;
                }
                const episodeRef = getEpisodeDataRef(episodeId);

                // Fetch current user data for this episode (to check old rating)
                const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/ratings`, episodeId);
                let oldRating = 0;
                try {
                    const userDocSnap = await getDoc(userDocRef);
                    oldRating = userDocSnap.exists() ? userDocSnap.data().rating : 0;
                } catch(e) {
                    console.error("Error fetching user rating:", e);
                }
                
                if (oldRating === newRating) {
                    newRating = 0; // User clicked the same rating, clearing it
                }

                await setDoc(userDocRef, { rating: newRating });

                // Update public episode statistics (using a transaction would be safer, but this is simpler)
                await setDoc(episodeRef, {}, { merge: true }); // Ensure document exists
                
                const episodeSnap = await getDoc(episodeRef);
                let { totalStars, count } = episodeSnap.exists() ? episodeSnap.data() : { totalStars: 0, count: 0 };
                
                // Adjust totals
                totalStars = (totalStars || 0) - (oldRating || 0) + newRating;
                if (oldRating > 0 && newRating === 0) {
                    count = (count || 1) - 1; // Decrement count if rating is cleared
                } else if (oldRating === 0 && newRating > 0) {
                    count = (count || 0) + 1; // Increment count for a new rating
                }

                // Protect against negative counts/totals
                totalStars = Math.max(0, totalStars);
                count = Math.max(0, count);

                await updateDoc(episodeRef, {
                    totalStars: totalStars,
                    count: count,
                    [`users.${userId}`]: newRating, // Store last rating for easy user lookup
                });
                
                console.log(`Rating for ${episodeId} updated. New Rating: ${newRating}`);
            };

            /** Sets up the real-time listener for the hero episode's rating. */
            const setupHeroRatingListener = (episodeId) => {
                const episodeRef = getEpisodeDataRef(episodeId);
                
                // Real-time listener
                onSnapshot(episodeRef, (doc) => {
                    let ratingData = { totalStars: 0, count: 0, userRating: 0 };
                    
                    if (doc.exists()) {
                        const data = doc.data();
                        ratingData.totalStars = data.totalStars || 0;
                        ratingData.count = data.count || 0;
                        if (userId && data.users && data.users[userId]) {
                            ratingData.userRating = data.users[userId];
                        }
                    }
                    renderStarRating(episodeId, ratingData);
                }, (error) => {
                    console.error("Error setting up rating listener:", error);
                });
            };

            // 6. My List / Favorites Functions
            
            /** Toggles an episode in the current user's "My List". */
            const toggleMyList = async (episodeId, buttonElement) => {
                if (!userId) {
                    showCustomModal('Authentication Required', 'Please wait until user authentication is complete before saving to My List.', 'Error');
                    return;
                }
                
                const favoritesRef = getFavoritesRef();
                
                // Get current state
                const docSnap = await getDoc(favoritesRef);
                const favorites = docSnap.exists() ? docSnap.data().episodes || [] : [];
                const isInList = favorites.includes(episodeId);
                
                let message = '';
                
                if (isInList) {
                    await updateDoc(favoritesRef, {
                        episodes: arrayRemove(episodeId)
                    });
                    message = 'Removed from My List!';
                } else {
                    await setDoc(favoritesRef, {
                        episodes: arrayUnion(episodeId)
                    }, { merge: true });
                    message = 'Added to My List!';
                }
                
                showCustomModal('My List', message);

                // Update the button state immediately
                updateMyListButtonState(episodeId, favoritesRef, buttonElement, !isInList);
            };

            /** Updates the "My List" button appearance based on its current state. */
            const updateMyListButtonState = async (episodeId, favoritesRef, buttonElement, forceState = null) => {
                if (!buttonElement || !userId) return;

                let isInList = false;
                if (forceState !== null) {
                    isInList = forceState;
                } else {
                    try {
                        const docSnap = await getDoc(favoritesRef);
                        const favorites = docSnap.exists() ? docSnap.data().episodes || [] : [];
                        isInList = favorites.includes(episodeId);
                    } catch (e) {
                        console.error("Error checking favorites:", e);
                    }
                }
                
                buttonElement.innerHTML = `
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="${isInList ? 'M5 13l4 4L19 7' : 'M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v10H5V5zM8 7h4v2H8V7zm0 4h4v2H8v-2z'}"></path>
                    </svg>
                    ${isInList ? 'Remove from My List' : 'Add to My List'}
                `;
                // Adjust styling
                buttonElement.classList.toggle('bg-gray-700', isInList);
                buttonElement.classList.toggle('hover:bg-gray-600', isInList);
                buttonElement.classList.toggle('btn-primary', !isInList);
                buttonElement.classList.toggle('opacity-50', !userId);
            };

            // 7. Rendering Functions
            
            /** Renders the main Hero section */
            const renderHeroSection = (latestEpisode, currentUserId) => {
                const hero = document.getElementById('hero-section');
                const youtubeEmbedUrl = `https://www.youtube.com/embed/${latestEpisode.youtubeId}?autoplay=0&rel=0&showinfo=0&iv_load_policy=3`;
                const myListButtonId = `my-list-btn-hero`;

                LATEST_EPISODE_ID = latestEpisode.id; // Set global ID for rating listener

                hero.innerHTML = `
                    <div class="relative h-screen flex items-center justify-center bg-black overflow-hidden">
                        <!-- Hero Image/Background (Placeholder) -->
                        <img src="${latestEpisode.imageUrl.replace('400x225', '1920x1080')}" onerror="this.src='https://placehold.co/1920x1080/000/fff?text=WESTPINE!+S${latestEpisode.season}+E${latestEpisode.id.slice(3)}'" alt="Hero Image" class="absolute inset-0 w-full h-full object-cover opacity-30 blur-sm z-0">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black z-10"></div>

                        <!-- Hero Content -->
                        <div class="relative z-20 max-w-5xl px-6 md:px-12 lg:px-20 text-white">
                            <span class="text-xl font-bold text-westpine">${latestEpisode.duration} | S${latestEpisode.season} E${latestEpisode.id.slice(3)} | Latest Episode</span>
                            <h1 class="text-6xl md:text-8xl font-black mt-2 mb-4 drop-shadow-lg">${latestEpisode.title}</h1>
                            <p class="text-lg mb-6 max-w-xl">${latestEpisode.description}</p>
                            
                            <!-- Interaction Controls -->
                            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                                <button onclick="document.getElementById('video-modal').classList.remove('hidden'); document.getElementById('youtube-iframe').src='${youtubeEmbedUrl}'" class="btn-primary flex items-center px-8 py-3 rounded-lg text-lg font-semibold shadow-lg hover:shadow-red-500/50">
                                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                                    Watch Episode
                                </button>
                                <button id="${myListButtonId}" class="flex items-center px-6 py-3 rounded-lg text-lg font-semibold bg-gray-700 hover:bg-gray-600 transition duration-200 text-gray-200">
                                    Loading List...
                                </button>
                                
                                <!-- Star Rating System -->
                                <div id="star-rating-container" class="p-3 bg-westpine-dark/70 backdrop-blur-sm rounded-lg shadow-xl">
                                    <div class="text-center text-gray-400">Loading rating...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // After rendering, initialize the list button functionality
                const myListButton = document.getElementById(myListButtonId);
                if (myListButton && currentUserId) {
                    const favoritesRef = getFavoritesRef();
                    // Initial state update
                    updateMyListButtonState(latestEpisode.id, favoritesRef, myListButton);
                    // Attach click handler
                    myListButton.onclick = () => toggleMyList(latestEpisode.id, myListButton);
                }

                setupHeroRatingListener(latestEpisode.id);
            };

            /** Renders the episode carousels grouped by season. */
            const renderEpisodeCarousels = (episodes) => {
                const container = document.getElementById('episode-carousels');
                if (!container) return;
                
                // Group, sort, and render episodes
                const seasons = episodes.reduce((acc, ep) => {
                    (acc[ep.season] = acc[ep.season] || []).push(ep);
                    return acc;
                }, {});

                let html = '';
                Object.keys(seasons).sort((a, b) => parseInt(a) - parseInt(b)).forEach(season => {
                    const seasonEpisodes = seasons[season].sort((a, b) => parseInt(a.id.slice(3)) - parseInt(b.id.slice(3)));
                    const seasonTitle = `Season ${season}${season == 1 ? ': The Beginning' : ': Continued'}`;

                    html += `
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold mb-4 ml-6 md:ml-12">${seasonTitle}</h2>
                            <div class="carousel flex overflow-x-scroll space-x-4 p-4 ml-6 md:ml-12">
                                ${seasonEpisodes.map(ep => `
                                    <div onclick="showEpisodeDetail('${ep.id}')" class="flex-shrink-0 w-64 md:w-80 rounded-lg overflow-hidden transform hover:scale-[1.02] transition duration-300 cursor-pointer shadow-xl bg-westpine-dark group">
                                        <img src="${ep.imageUrl}" onerror="this.src='https://placehold.co/400x225/000/fff?text=S${ep.season}+E${ep.id.slice(3)}'" alt="${ep.title}" class="w-full h-auto object-cover group-hover:opacity-80 transition duration-300">
                                        <div class="p-3">
                                            <p class="text-sm text-gray-400">S${ep.season} E${ep.id.slice(3)} - ${ep.duration}</p>
                                            <h3 class="text-lg font-semibold truncate group-hover:text-westpine">${ep.title}</h3>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            };

            // 8. Main Application Logic
            const renderApp = (episodes, currentUserId) => {
                if (!episodes || episodes.length === 0) {
                    document.getElementById('hero-section').innerHTML = '';
                    document.getElementById('episode-carousels').innerHTML = '<div class="text-center py-40 text-gray-500">No episodes found. The data may be loading or the database is empty.</div>';
                    return;
                }
                
                // 1. Find the latest episode (Newest date first, fallback to episode number)
                const latestEpisode = episodes.sort((a, b) => {
                    if (b.date && a.date) {
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        if (dateB.getTime() !== dateA.getTime()) return dateB.getTime() - dateA.getTime();
                    }
                    if (b.season !== a.season) return b.season - a.season;
                    return parseInt(b.id.slice(3)) - parseInt(a.id.slice(3));
                })[0];
                
                // 2. Render the Hero section with the latest episode
                renderHeroSection(latestEpisode, currentUserId);

                // 3. Render all episodes organized by season
                renderEpisodeCarousels(episodes);
            };


            authReadyPromise.then((currentUserId) => {
                // Initial fetch and set up real-time listener for the episode list
                ensureEpisodeDataAndListen(currentUserId);
            });

            // 9. Global functions for Modals
            
            // Expose showEpisodeDetail globally for use in HTML onclick
            window.showEpisodeDetail = (episodeId) => {
                const ep = EPISODE_MAP[episodeId];
                if (!ep) return;
                
                const modal = document.getElementById('detail-modal');
                const title = document.getElementById('detail-title');
                const desc = document.getElementById('detail-description');
                const info = document.getElementById('detail-info');
                const watchBtn = document.getElementById('detail-watch-btn');
                const myListBtnDetail = document.getElementById('detail-my-list-btn');

                const youtubeEmbedUrl = `https://www.youtube.com/embed/${ep.youtubeId}?autoplay=0&rel=0&showinfo=0&iv_load_policy=3`;
                
                title.textContent = ep.title;
                desc.textContent = ep.description;
                info.innerHTML = `<span class="text-westpine font-bold">S${ep.season} E${ep.id.slice(3)}</span> | ${ep.duration} | Released: ${new Date(ep.date).toLocaleDateString()}`;
                
                watchBtn.onclick = () => {
                    document.getElementById('video-modal').classList.remove('hidden');
                    document.getElementById('youtube-iframe').src = youtubeEmbedUrl;
                    modal.classList.add('hidden');
                };

                // My List Button Setup for Detail Modal
                myListBtnDetail.onclick = () => toggleMyList(ep.id, myListBtnDetail);
                
                if (userId) {
                    const favoritesRef = getFavoritesRef();
                    updateMyListButtonState(ep.id, favoritesRef, myListBtnDetail);
                }

                modal.classList.remove('hidden');
            };

            // Expose global helpers
            window.handleRating = handleRating;
            window.toggleMyList = toggleMyList;
            window.showCustomModal = showCustomModal; // For future use
        } else {
            document.getElementById('main-content').innerHTML = '<div class="text-center py-20 text-red-500">Configuration Error: Firebase config is missing. Cannot load app.</div>';
        }
    </script>

    <!-- Navigation Bar -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-sm shadow-xl px-6 md:px-12 py-4">
        <div class="flex justify-between items-center max-w-7xl mx-auto">
            <div class="flex items-center space-x-6">
                <a href="#" class="text-3xl font-extrabold tracking-tight text-westpine">Westpine!</a>
                <nav class="hidden sm:flex space-x-6 text-sm font-semibold">
                    <a href="#" class="hover:text-westpine transition duration-200">Home</a>
                    <a href="#episodes" class="hover:text-westpine transition duration-200">Episodes</a>
                    <a href="#" class="hover:text-westpine transition duration-200">About Us</a>
                </nav>
            </div>
            <div id="user-id-display" class="text-xs text-gray-500 truncate max-w-[100px] md:max-w-xs">Loading Auth...</div>
        </div>
    </header>

    <!-- Main Content Wrapper -->
    <div id="main-content">
        <!-- Hero Section (Latest Episode) -->
        <section id="hero-section" class="pt-20"></section>

        <!-- Episode Carousels -->
        <section id="episodes" class="py-12 md:py-16">
            <div id="episode-carousels">
                <!-- Content will be injected here by JavaScript -->
                <div class="text-center py-20 text-gray-500">Loading episodes...</div>
            </div>
        </section>
    </div>

    <!-- Video Player Modal (for watching the episode) -->
    <div id="video-modal" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-4" onclick="this.classList.add('hidden'); document.getElementById('youtube-iframe').src=''">
        <div class="relative w-full max-w-4xl h-auto aspect-video rounded-xl overflow-hidden shadow-2xl" onclick="event.stopPropagation()">
            <iframe id="youtube-iframe" width="100%" height="100%" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
            <button class="absolute top-4 right-4 text-white hover:text-westpine transition" onclick="document.getElementById('video-modal').classList.add('hidden'); document.getElementById('youtube-iframe').src=''">
                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
        </div>
    </div>

    <!-- Episode Detail Modal (like the Stranger Things detailed view) -->
    <div id="detail-modal" class="fixed inset-0 bg-black/95 z-40 hidden flex items-center justify-center p-4" onclick="this.classList.add('hidden')">
        <div class="relative w-full max-w-4xl bg-westpine-dark rounded-xl shadow-2xl overflow-hidden transform transition duration-300" onclick="event.stopPropagation()">
            <button class="absolute top-4 right-4 text-white z-10 p-2 rounded-full bg-black/50 hover:bg-westpine transition" onclick="document.getElementById('detail-modal').classList.add('hidden')">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            
            <div class="p-8">
                <h2 id="detail-title" class="text-4xl font-bold mb-2">Episode Title</h2>
                <p id="detail-info" class="text-lg text-gray-400 mb-4"></p>
                <p id="detail-description" class="text-gray-200 mb-6"></p>
                
                <div class="flex space-x-4">
                    <button id="detail-watch-btn" class="btn-primary flex items-center px-6 py-3 rounded-lg text-lg font-semibold shadow-lg hover:shadow-red-500/50">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                        Watch Now
                    </button>
                    <button id="detail-my-list-btn" class="flex items-center px-6 py-3 rounded-lg text-lg font-semibold bg-gray-700 hover:bg-gray-600 transition duration-200 text-gray-200">
                        Add to My List
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Alert/Notification Modal -->
    <div id="custom-alert-modal" class="fixed inset-0 bg-black/75 z-[99] hidden flex items-center justify-center p-4" onclick="this.classList.add('hidden')">
        <div class="w-full max-w-sm bg-westpine-dark rounded-xl shadow-2xl overflow-hidden" onclick="event.stopPropagation()">
            <div id="custom-alert-header" class="p-4 rounded-t-xl text-white bg-westpine">
                <h3 id="custom-alert-title" class="font-bold text-xl">Notification</h3>
            </div>
            <div class="p-4">
                <p id="custom-alert-message" class="text-gray-300"></p>
                <button onclick="document.getElementById('custom-alert-modal').classList.add('hidden')" class="mt-4 w-full btn-primary px-4 py-2 rounded-lg font-semibold">
                    OK
                </button>
            </div>
        </div>
    </div>
</body>
</html>
